# 关于《院内推车路线规划》的详细说明

## 0. APP和web端的路径规划：

(1) 若管理员要设置一个路径a，则可在web端总共设置n个节点。

(2) APP负责控制手称机打印出路径码，点击开始打印，后将打印出的路径码张贴在设置的路径点。

(3) 工作的时推着推车每走到一个路径点，就使用物联终端的上的扫码枪扫一个条码确认打卡。

(4) 扫第一个条码时开始行程，然后按顺序挨个扫20个到最后一个条码完成行程。

(5) 打卡完所有的路径点表示路径走完，若超出一定时间未发现打卡信息或跳过了某个路径点，在报警日志提示报警信息。

###### 编辑记录

| 时间             | 编辑者 | 说明                                         |
| ---------------- | ------ | -------------------------------------------- |
| 2020.03.03 18:20 | CFY    | 首次编辑                                     |
| 2020.03.04 17:04 | CFY    | 删除一个终端（硬件）使用的接口，修改打卡接口 |
|                  |        |                                              |

## 1. 线路及点位编码格式

#### 1. 线路编码格式

机构代码+"PATH"+路线生成时间（年月日时分秒各2位）。

如：XMZY01PATH220303105442 表示机构(XMZY01)在22/03/03 10:54:42添加生成的线路

#### 2. 点位编码格式

机构代码+"NODE"+点位生成时间（年月日时分秒各2位）。

如：XMZY01NODE220303105442 表示机构(XMZY01)在22/03/03 10:54:42添加生成的点位

#### 3. 点位和线路可以并存，点位可以在多个线路中重复使用，生成线路或点位的时间间隔不得小于1秒，避免编码重复

## 2. 点位及线路规划分配方案

#### 1. web端设置线路包括两个模块

##### A “点位配置”：以点位为基础的点位生成与设置，包括：

1. 按照时间及机构自动生成点位编码
1. 对此点位进行备注
1. 添加、删除此点位，修改此点位的备注信息

##### B “推车路径规划”：以线路为基础的路线生成与设置，包括：

1. 按照时间及机构自动生成线路编码
1. 显示当前线路各个节点的打卡情况（打卡人员、打卡时间），打卡第一个点之后清空打卡情况
2. 对此线路进行备注
3. 添加、删除此线路，修改此线路的备注信息
4. 将“点位配置”中的点位添加至此线路中
6. 为此条线路添加或删除推车

#### 2. APP端与web功能保持同步，需通过蓝牙连接手称机，发送数据打印节点标签。

###### *APP蓝牙通信数据格式待编写

## 3. 功能运行流程

1. web端（或APP）添加编辑点位
2. web端（或APP）添加编辑线路，添加删除点位，调整点位顺序
3. APP连接手称机，打印节点标签
4. 终端硬件使用扫码枪扫描标签，上传进行打卡
5. 根据上传的信息判断是否正确

## 4. 权限问题

1. 进行推车路线规划的人员需拥有推车路线规划的权限
2. 拥有此功能的医院才可以给下属人员分配路线规划的权限
3. 机构类型为光植科技的机构才可以给其他医院分配此功能

## 5. 终端硬件的接口需求

#### 1. 打卡接口

HTTP POST application/x-www-form-urlencoded

请求参数

| 参数     | 参数类型 |
| -------- | -------- |
| IMEI     | string   |
| RFID     | string   |
| 点位编码 | string   |

返回参考（json）

~~~json
{
	"code": 200,
	"message": "success",
	"data": {
		"pathRemark": "二楼医废收集路线",
		"nodeRemark": "耳鼻喉科1室"
	}
}
~~~

诺打卡成功，返回当前线路备注（名称）、点位备注（名称）

无效打卡 将 打卡人、推车、打卡路线、打卡时间、打卡点位记录至报警日志

打卡人需按顺序打卡此路线所有点位，按照线路已规划点位打卡错误、确实打卡判定打卡无效，记录至报警日志，但是重复上一个打卡点位有效
