#  医废分类手持终端 V220304

###### 指令及功能说明

## 0. 说明

#### 版本关键词：

医废标签备注打印、院内推车路径规划节点打印

#### 版本确认

请首先由蓝牙主机 向 此设备 发送指令

```
GZVERS
```

设备返回版本号为

```
220304
```

表明该设备适用于本手册

#### 编辑历史

| 日期       | 作者 | 描述     |
| ---------- | ---- | -------- |
| 2022-03-08 | CFY  | 首次提交 |

## 1. 关键指令添加

#### 1. 医废标签备注打印

由蓝牙主机 向 此设备 **发送指令**

~~~json
{
	"Code": "H0XMZY012203041732P0112345",
	"Remark": "99% 一氧化二氢溶液(99% Dihydrogen Monoxide)",
	"labelType": "SGMWIR"
}
~~~

发送数据指令时**可不包含**回车换行(0x0D 0x0A)

指令内容格式为**JSON**，其中

对象"**Code**"的值为26位医废编码字符串；

对象"**Remark**"的值为医废标签备注，内容编码需为**GBK**格式，中文及符号占2个字节，英文及符号占1个字节，最多容纳58个字节（29个中文字符）；

对象"**labelType**"的固定值为"**SGMWIR**"，表示此医废标签包含备注内容*。

###### *注：为了兼容设备旧版本程序，当医废标签不包含备注内容时，仅向设备发送26位医废编码即可。

**蓝牙设备返回**

~~~
00000
~~~

#### 2. 院内推车路径规划节点打印

由蓝牙主机 向 此设备 **发送指令**

~~~json
{
	"Code": "XMZY01NODE220303105442",
	"Remark": "二楼耳鼻喉科2",
	"labelType": "HCRPN"
}
~~~

发送数据指令时**可不包含**回车换行(0x0D 0x0A)

指令内容格式为**JSON**，其中

对象"**Code**"的值为22位院内推车路径规划点位编码字符串；

对象"**Remark**"的值为医废标签备注，内容编码需为**GBK**格式，中文及符号占2个字节，英文及符号占1个字节，最多容纳40个字节（20个中文字符）；

对象"**labelType**"的固定值为"**HCRPN**"，表示此标签为院内推车路径规划点位标签。

**蓝牙设备返回**

~~~
00000
~~~

## 2. 其他指令说明

#### 1. 标定（校准）指令

~~~
GZCL
~~~

参考[标定（校准）说明]()

#### 2. 打印标定（校准）参数

~~~
Param
~~~

返回

~~~
%dg: %d //数值的含义为 重量为0g时采样值
%dg: %d //数值的含义为 重量为ng时采样值
%f, %f  //数值的含义分别为 拟合直线(y = kx + b)参数k, b
~~~

#### 3. 切换输出模式

~~~
Debug
~~~

无返回，切换模式为[1](https://gitee.com/Heanden/Description-of-calibration-function-requirements/blob/master/%E5%8C%BB%E5%BA%9F%E5%88%86%E7%B1%BB%E6%89%8B%E6%8C%81%E7%BB%88%E7%AB%AF(%E6%89%8B%E7%A7%B0%E6%9C%BA)%20220209%5BQR%5D%20%E6%8C%87%E4%BB%A4%E5%8F%8A%E5%8A%9F%E8%83%BD%E8%AF%B4%E6%98%8E.md#1-%E9%BB%98%E8%AE%A4%E7%A7%B0%E9%87%8D%E6%A8%A1%E5%BC%8F)、[2](https://gitee.com/Heanden/Description-of-calibration-function-requirements/blob/master/%E5%8C%BB%E5%BA%9F%E5%88%86%E7%B1%BB%E6%89%8B%E6%8C%81%E7%BB%88%E7%AB%AF(%E6%89%8B%E7%A7%B0%E6%9C%BA)%20220209%5BQR%5D%20%E6%8C%87%E4%BB%A4%E5%8F%8A%E5%8A%9F%E8%83%BD%E8%AF%B4%E6%98%8E.md#2-%E6%BA%90%E6%95%B0%E5%80%BC%E6%A8%A1%E5%BC%8F)

#### 4. 去皮（获取皮重）

~~~
GZTARE
~~~

无返回

#### 5. 获取一次原始数据（经过中值平均滤波器）

~~~
GZGET
~~~

返回

~~~
[%d] //经过中值平均滤波器源数值
~~~

#### 6. 打印机命令中转

~~~
CTSxxxCTE // xxx为十六进制，将通过UART总线直接发送至标签打印机
~~~

无返回

#### 7. 打印标签打印机自检页

~~~
GZPTCF
~~~

无返回，打印自检页

#### 8. 调整打印机热参数

~~~
DCddTMdddTIddPTHM
/*
 * 参数解析
 * DCdd     DC: 关键字；数值: 最大加热点数(单位：8点，范围：0-255)
 * TMddd    TM: 关键字；数值: 加热时间(单位: us，范围：0-255)
 * TIdd     TI: 关键字；数值: 加热间隔时间(单位: us，范围：0-255)
 */
~~~

无返回，打印自检页

#### 9. 获取手称机版本号

~~~
GZVERS
~~~

返回

~~~
220209[QR]
~~~

#### 10. 打印**包含**备注的医废标签

见

#### 11. 打印院内推车路径规划节点标签

见

#### 12. 打印**不包含**备注的医废标签

无指令，发送数量满足26位字符串，返回

~~~
00000
~~~

#### 13. 其他字符

返回

~~~
00
~~~

## 3. 模式说明

#### 1. (默认)称重模式

APP连接手称机蓝牙成功后，手称机直接返回重量测量值(string)

重量测量值发送频率（大约）为1s，除以下情况：

1. 重量测量值过低时，连续发送'0'；

2. 重量测量值趋于稳定时，减小发送频率。

#### 2. 调试模式（多数据输出）

调试数据发送频率（大约）为1s

数据格式为

~~~
convert: %d        //数值的含义为 经过回归计算的测量值
source: %d         //数值的含义为 经过三次滑动平均滤波的源数值
tare: %d           //数值的含义为 皮重(源数值)
relativeSource: %d //数值的含义为 采样值(源数值) - 皮重(源数值)
~~~
